<!DOCTYPE openRPTDef>
<report>
 <title>Incidents By CRM Account</title>
 <name>IncidentsByCRMAccount</name>
 <description>List the Incidents and Related To-Do List Items for all CRM Accounts or a specified CRM Account.</description>
 <size>Letter</size>
 <portrait/>
 <topmargin>50</topmargin>
 <bottommargin>50</bottommargin>
 <rightmargin>50</rightmargin>
 <leftmargin>50</leftmargin>
 <querysource>
  <name>detail</name>
  <sql>SELECT crmacct_id, COALESCE(TEXT(incdt_id), '') AS incdt_id, todoitem_id,
       crmacct_number, crmacct_name,
       incdt_number, DATE(incdt_timestamp) AS incdt_timestamp,
       CASE WHEN(incdt_status='N') THEN &lt;? value("new") ?>
            WHEN(incdt_status='F') THEN &lt;? value("feedback") ?>
            WHEN(incdt_status='C') THEN &lt;? value("confirmed") ?>
            WHEN(incdt_status='A') THEN &lt;? value("assigned") ?>
            WHEN(incdt_status='R') THEN &lt;? value("resolved") ?>
            WHEN(incdt_status='L') THEN &lt;? value("closed") ?>
            ELSE incdt_status
       END AS incdt_status,
       incdt_assigned_username, incdt_summary,
       todoitem_due_date, todoitem_name,
       todoitem_username AS todoitem_usrname,
       todoitem_assigned_date, todoitem_status,
       incdtseverity_name,
       incdtpriority_name
FROM crmacct
&lt;? if exists("showAcctsWOIncdts") ?>
  LEFT OUTER
&lt;? endif ?>
      JOIN incdt ON (incdt_crmacct_id=crmacct_id
                     AND (incdt_timestamp BETWEEN &lt;? value("startDate") ?>
                                              AND &lt;? value("endDate") ?>)
                     &lt;? if not exists("showClosed") ?>
                       AND (incdt_status != 'L')
                     &lt;? endif ?>)
      LEFT OUTER JOIN todoitem ON (todoitem_incdt_id=incdt_id AND
                                  (todoitem_status IS NULL OR todoitem_status != 'C'))
      LEFT OUTER JOIN incdtseverity ON (incdt_incdtseverity_id = incdtseverity_id)
      LEFT OUTER JOIN incdtpriority ON (incdt_incdtpriority_id = incdtpriority_id)
WHERE (TRUE
&lt;? if exists("crmacct_id") ?>
  AND (crmacct_id=&lt;? value("crmacct_id") ?>)
&lt;? endif ?>
&lt;? if exists("showAcctsWOIncdts") ?>
   AND (incdt_id IS NULL OR (true
&lt;? endif ?>

&lt;? if exists("showAcctsWOIncdts") ?>
   ))
&lt;? endif ?>
 ) 
ORDER BY crmacct_name, incdt_timestamp, todoitem_due_date;</sql>
 </querysource>
 <querysource>
  <name>queryParams</name>
  <sql>SELECT
  &lt;? if exists("showClosed") ?> 'Yes' &lt;? else ?> 'No' &lt;? endif ?> AS showClosed,
  &lt;? if exists("showAcctsWOIncdts") ?> 'Yes' &lt;? else ?> 'No' &lt;? endif ?> AS showAcctsWOIncdts,
  &lt;? if exists("crmacct_id") ?>
    crmacct_name
    FROM crmacct
    WHERE (crmacct_id=&lt;? value("crmacct_id") ?>)
  &lt;? elseif exists("crmacct_pattern") ?>
    &lt;? value("crmacct_pattern") ?>
  &lt;? else ?>
    'ALL' AS crmacct_name
  &lt;? endif ?>
;</sql>
 </querysource>
 <rpthead>
  <height>151</height>
  <label>
   <rect>
    <x>295</x>
    <y>10</y>
    <width>450</width>
    <height>37</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>18</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Incidents By CRM Account</string>
  </label>
  <label>
   <rect>
    <x>325</x>
    <y>60</y>
    <width>50</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>normal</weight>
   </font>
   <hcenter/>
   <vcenter/>
   <string>and</string>
  </label>
  <line>
   <xstart>1</xstart>
   <ystart>141</ystart>
   <xend>741</xend>
   <yend>141</yend>
   <weight>2</weight>
  </line>
  <label>
   <rect>
    <x>690</x>
    <y>110</y>
    <width>50</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Priority</string>
  </label>
  <label>
   <rect>
    <x>10</x>
    <y>110</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Incident #</string>
  </label>
  <label>
   <rect>
    <x>630</x>
    <y>110</y>
    <width>50</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Severity</string>
  </label>
  <label>
   <rect>
    <x>320</x>
    <y>125</y>
    <width>200</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>To-Do Item Name</string>
  </label>
  <field>
   <rect>
    <x>225</x>
    <y>90</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>9</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>queryParams</query>
    <column>showClosed</column>
   </data>
  </field>
  <label>
   <rect>
    <x>5</x>
    <y>75</y>
    <width>215</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>normal</weight>
   </font>
   <right/>
   <top/>
   <string>Show Accounts With No Incidents:</string>
  </label>
  <label>
   <rect>
    <x>100</x>
    <y>125</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>To-Do Item Status</string>
  </label>
  <label>
   <rect>
    <x>570</x>
    <y>125</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>Assigned Date</string>
  </label>
  <label>
   <rect>
    <x>180</x>
    <y>110</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Assigned To</string>
  </label>
  <label>
   <rect>
    <x>300</x>
    <y>110</y>
    <width>200</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Summary</string>
  </label>
  <label>
   <rect>
    <x>650</x>
    <y>125</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>Due Date</string>
  </label>
  <label>
   <rect>
    <x>200</x>
    <y>125</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>Assigned To</string>
  </label>
  <field>
   <rect>
    <x>375</x>
    <y>60</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>9</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Parameter Query</query>
    <column>endDate</column>
   </data>
  </field>
  <field>
   <rect>
    <x>225</x>
    <y>45</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>9</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>queryParams</query>
    <column>crmacct_name</column>
   </data>
  </field>
  <label>
   <rect>
    <x>5</x>
    <y>45</y>
    <width>215</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>CRM Account:</string>
  </label>
  <label>
   <rect>
    <x>5</x>
    <y>60</y>
    <width>215</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Create Date between:</string>
  </label>
  <label>
   <rect>
    <x>5</x>
    <y>90</y>
    <width>215</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>normal</weight>
   </font>
   <right/>
   <top/>
   <string>Show Closed Incidents:</string>
  </label>
  <label>
   <rect>
    <x>100</x>
    <y>110</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Status</string>
  </label>
  <label>
   <rect>
    <x>550</x>
    <y>110</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Created</string>
  </label>
  <field>
   <rect>
    <x>225</x>
    <y>60</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>9</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Parameter Query</query>
    <column>startDate</column>
   </data>
  </field>
  <field>
   <rect>
    <x>225</x>
    <y>75</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>9</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>queryParams</query>
    <column>showAcctsWOIncdts</column>
   </data>
  </field>
 </rpthead>
 <pghead>
  <firstpage/>
  <height>6</height>
 </pghead>
 <pghead>
  <height>41</height>
  <label>
   <rect>
    <x>200</x>
    <y>15</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>Assigned To</string>
  </label>
  <label>
   <rect>
    <x>550</x>
    <y>0</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Created</string>
  </label>
  <label>
   <rect>
    <x>320</x>
    <y>15</y>
    <width>200</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>To-Do Item Name</string>
  </label>
  <label>
   <rect>
    <x>630</x>
    <y>0</y>
    <width>50</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Severity</string>
  </label>
  <label>
   <rect>
    <x>100</x>
    <y>15</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>To-Do Item Status</string>
  </label>
  <label>
   <rect>
    <x>650</x>
    <y>15</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>Due Date</string>
  </label>
  <label>
   <rect>
    <x>100</x>
    <y>0</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Status</string>
  </label>
  <label>
   <rect>
    <x>300</x>
    <y>0</y>
    <width>200</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Summary</string>
  </label>
  <line>
   <xstart>5</xstart>
   <ystart>30</ystart>
   <xend>745</xend>
   <yend>30</yend>
   <weight>2</weight>
  </line>
  <label>
   <rect>
    <x>690</x>
    <y>0</y>
    <width>50</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Priority</string>
  </label>
  <label>
   <rect>
    <x>10</x>
    <y>0</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Incident</string>
  </label>
  <label>
   <rect>
    <x>570</x>
    <y>15</y>
    <width>75</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>Assigned Date</string>
  </label>
  <label>
   <rect>
    <x>180</x>
    <y>0</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Assigned To</string>
  </label>
 </pghead>
 <section>
  <name>detail</name>
  <group>
   <name>CRMAccount</name>
   <column>crmacct_id</column>
   <head>
    <height>22</height>
    <field>
     <rect>
      <x>100</x>
      <y>0</y>
      <width>200</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>10</size>
      <weight>bold</weight>
     </font>
     <left/>
     <vcenter/>
     <data>
      <query>detail</query>
      <column>crmacct_name</column>
     </data>
    </field>
    <field>
     <rect>
      <x>10</x>
      <y>0</y>
      <width>80</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>10</size>
      <weight>bold</weight>
     </font>
     <left/>
     <vcenter/>
     <data>
      <query>detail</query>
      <column>crmacct_number</column>
     </data>
    </field>
   </head>
  </group>
  <group>
   <name>Incident</name>
   <column>incdt_id</column>
   <head>
    <height>26</height>
    <field>
     <rect>
      <x>630</x>
      <y>0</y>
      <width>50</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <top/>
     <data>
      <query>detail</query>
      <column>incdtseverity_name</column>
     </data>
    </field>
    <field>
     <rect>
      <x>690</x>
      <y>0</y>
      <width>50</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <top/>
     <data>
      <query>detail</query>
      <column>incdtpriority_name</column>
     </data>
    </field>
    <field>
     <rect>
      <x>300</x>
      <y>0</y>
      <width>225</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <top/>
     <data>
      <query>detail</query>
      <column>incdt_summary</column>
     </data>
    </field>
    <field>
     <rect>
      <x>10</x>
      <y>0</y>
      <width>75</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <top/>
     <data>
      <query>detail</query>
      <column>incdt_number</column>
     </data>
    </field>
    <field>
     <rect>
      <x>180</x>
      <y>0</y>
      <width>100</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <top/>
     <data>
      <query>detail</query>
      <column>incdt_assigned_username</column>
     </data>
    </field>
    <text>
     <rect>
      <x>300</x>
      <y>15</y>
      <width>450</width>
      <height>15</height>
     </rect>
     <bottompad>0</bottompad>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <top/>
     <data>
      <query>detail</query>
      <column>incdt_descrip</column>
     </data>
    </text>
    <field>
     <rect>
      <x>550</x>
      <y>0</y>
      <width>75</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <top/>
     <data>
      <query>detail</query>
      <column>incdt_timestamp</column>
     </data>
    </field>
    <field>
     <rect>
      <x>100</x>
      <y>0</y>
      <width>75</width>
      <height>15</height>
     </rect>
     <font>
      <face>Arial</face>
      <size>8</size>
      <weight>bold</weight>
     </font>
     <left/>
     <top/>
     <data>
      <query>detail</query>
      <column>incdt_status</column>
     </data>
    </field>
   </head>
   <foot>
    <height>6</height>
    <line>
     <xstart>17</xstart>
     <ystart>5</ystart>
     <xend>740</xend>
     <yend>5</yend>
     <weight>0</weight>
    </line>
   </foot>
  </group>
  <detail>
   <key>
    <query>detail</query>
   </key>
   <height>18</height>
   <field>
    <rect>
     <x>650</x>
     <y>0</y>
     <width>75</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>todoitem_due_date</column>
    </data>
   </field>
   <field>
    <rect>
     <x>150</x>
     <y>0</y>
     <width>25</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>todoitem_status</column>
    </data>
   </field>
   <field>
    <rect>
     <x>200</x>
     <y>0</y>
     <width>100</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>todoitem_usrname</column>
    </data>
   </field>
   <field>
    <rect>
     <x>320</x>
     <y>0</y>
     <width>225</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>todoitem_name</column>
    </data>
   </field>
   <field>
    <rect>
     <x>570</x>
     <y>0</y>
     <width>75</width>
     <height>15</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>8</size>
     <weight>bold</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>todoitem_assigned_date</column>
    </data>
   </field>
  </detail>
 </section>
 <pgfoot>
  <height>16</height>
  <label>
   <rect>
    <x>615</x>
    <y>0</y>
    <width>85</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Page:</string>
  </label>
  <field>
   <rect>
    <x>90</x>
    <y>0</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>report_date</column>
   </data>
  </field>
  <label>
   <rect>
    <x>0</x>
    <y>0</y>
    <width>85</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Report Date:</string>
  </label>
  <field>
   <rect>
    <x>705</x>
    <y>0</y>
    <width>40</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>page_number</column>
   </data>
  </field>
 </pgfoot>
</report>
